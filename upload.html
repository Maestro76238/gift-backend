<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Gift Admin Panel</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        padding: 40px;
        display: flex;
        justify-content: center;
    }
    .container {
        width: 500px;
        background: #fff;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.15);
    }
    h2 {
        text-align: center;
        margin-bottom: 20px;
    }
    #drop-zone {
        border: 2px dashed #888;
        padding: 40px;
        border-radius: 10px;
        text-align: center;
        cursor: pointer;
        margin-bottom: 15px;
        color: #555;
        transition: 0.2s;
    }
    #drop-zone.dragover {
        border-color: #4CAF50;
        background: #e8ffe8;
        color: #222;
    }
    #file-info {
        margin: 10px 0;
        color: #333;
        font-size: 14px;
    }
    input[type="password"], input[type="file"] {
        width: 100%;
        padding: 10px;
        margin: 10px 0 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
    }
    button {
        width: 100%;
        padding: 12px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }
    button:hover {
        background: #45a049;
    }
    #progress {
        width: 100%;
        height: 8px;
        background: #ddd;
        border-radius: 4px;
        margin-top: 15px;
        overflow: hidden;
        display: none;
    }
    #progress-bar {
        height: 100%;
        width: 0%;
        background: #4CAF50;
    }
    #result {
        margin-top: 20px;
        padding: 15px;
        background: #f0f0f0;
        border-radius: 10px;
        font-size: 16px;
        display: none;
    }
    .copy-btn {
        margin-top: 10px;
        background: #2196F3;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Admin ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–∞</h2>

    <div id="drop-zone">–ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏</div>

    <input type="file" id="file-input" style="display:none">

    <div id="file-info"></div>

    <input type="password" id="admin-pass" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥–º–∏–Ω-–ø–∞—Ä–æ–ª—å">

    <button onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>

    <div id="progress">
        <div id="progress-bar"></div>
    </div>

    <div id="result"></div>
</div>

<script>
const API_URL = "https://gift-backend-tn9w.onrender.com/api/create-gift";

let selectedFile = null;
const dropZone = document.getElementById("drop-zone");
const fileInput = document.getElementById("file-input");

// –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
dropZone.onclick = () => fileInput.click();

// File selected manually
fileInput.onchange = (e) => {
    selectedFile = e.target.files[0];
    showFileInfo();
};

// Drag & Drop
dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("dragover");
});
dropZone.addEventListener("dragleave", () => dropZone.classList.remove("dragover"));
dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    selectedFile = e.dataTransfer.files[0];
    showFileInfo();
});

function showFileInfo() {
    if (selectedFile) {
        document.getElementById("file-info").textContent =
            `–§–∞–π–ª: ${selectedFile.name} (${(selectedFile.size / 1024 / 1024).toFixed(2)} MB)`;
    }
}

async function uploadFile() {
    if (!selectedFile) {
        alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");
        return;
    }

    const pass = document.getElementById("admin-pass").value;
    if (!pass) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∞–¥–º–∏–Ω-–ø–∞—Ä–æ–ª—å!");
        return;
    }

    const formData = new FormData();
    formData.append("file", selectedFile);

    const progressBar = document.getElementById("progress");
    const bar = document.getElementById("progress-bar");
    progressBar.style.display = "block";
    bar.style.width = "0%";

    const xhr = new XMLHttpRequest();
    xhr.open("POST", API_URL);

    xhr.setRequestHeader("x-admin-pass", pass);

    xhr.upload.onprogress = (event) => {
        if (event.lengthComputable) {
            let percent = (event.loaded / event.total) * 100;
            bar.style.width = percent + "%";
        }
    };

    xhr.onload = () => {
        const result = document.getElementById("result");

        if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            result.style.display = "block";
            result.innerHTML = `
                üéâ –ü–æ–¥–∞—Ä–æ–∫ —Å–æ–∑–¥–∞–Ω!<br>
                –ö–æ–¥: <b>${response.code}</b>
                <button class="copy-btn" onclick="copyText('${response.code}')">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            `;
        } else {
            result.style.display = "block";
            result.innerHTML = "‚ùå –û—à–∏–±–∫–∞: " + xhr.responseText;
        }
    };

    xhr.send(formData);
}

function copyText(text) {
    navigator.clipboard.writeText(text);
    alert("–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
}
</script>

</body>
</html>
