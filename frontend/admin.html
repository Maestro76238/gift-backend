<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
</head>
<body>

<h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å üîë</h1>

<input id="pwd" type="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞">
<button onclick="login()">–í–æ–π—Ç–∏</button>

<div id="panel" style="display:none; margin-top:40px;">
  <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á</h2>

  <textarea id="gift" placeholder='–ù–∞–ø—Ä–∏–º–µ—Ä: {"type":"link","value":"https://..."}'
            style="width:300px;height:80px;"></textarea>
  <br><br>

  <button onclick="generateKey()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>

  <p id="result"></p>
</div>

<script>

let adminPassword = null;

async function login() {
  const password = document.getElementById("pwd").value;
  const res = await fetch(window.API_URL + "/admin/login", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ password })
  });

  const data = await res.json();

  if (data.ok) {
    adminPassword = password;
    document.getElementById("panel").style.display = "block";
  } else {
    alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
  }
}

async function generateKey() {
  const gift = JSON.parse(document.getElementById("gift").value || "{}");

  const res = await fetch(window.API_URL + "/admin/generate", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ password: adminPassword, gift })
  });

  const data = await res.json();

  if (data.ok) {
    document.getElementById("result").innerHTML =
      "–ù–æ–≤—ã–π –∫–ª—é—á: <b>" + data.key + "</b>";
  } else {
    alert(JSON.stringify(data));
  }
}
</script>

</body>
</html>